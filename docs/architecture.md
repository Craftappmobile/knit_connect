# Архітектура "Розрахуй і В'яжи"

Цей документ описує загальну архітектуру додатку "Розрахуй і В'яжи", включаючи структуру проєкту, потік даних та основні компоненти.

## Загальний огляд

"Розрахуй і В'яжи" - це mobile-first додаток з підтримкою офлайн-режиму для майстрів в'язання. Додаток побудований на архітектурі Offline-First з використанням React Native (Expo), TypeScript, Supabase та WatermelonDB для локального зберігання даних.

## Ключові архітектурні принципи

1. **Offline-First**: Додаток повинен працювати повноцінно навіть без доступу до Інтернету
2. **Mobile-First**: Інтерфейс оптимізований для мобільних пристроїв, але адаптується до планшетів
3. **Типобезпека**: Використання TypeScript для забезпечення типової безпеки
4. **Компонентний підхід**: Використання перевикористовуваних компонентів
5. **Декларативний стиль**: Використання TailwindCSS (NativeWind) для стилізації

## Архітектурні шари

### 1. Шар представлення (UI)

Відповідає за відображення інтерфейсу користувача та обробку взаємодій:

- **Екрани** (`app/`): Основні екрани додатку, побудовані на Expo Router
- **Компоненти** (`components/`): Перевикористовувані UI компоненти
- **Контексти** (`context/`): React контексти для управління глобальним станом

### 2. Шар бізнес-логіки

Реалізує бізнес-логіку додатку:

- **Хуки** (`hooks/`): Кастомні React хуки
- **Сервіси** (`services/`): Бізнес-логіка, незалежна від UI
- **Утиліти** (`lib/utils.ts`): Допоміжні функції

### 3. Шар даних

Відповідає за управління даними:

- **Локальне сховище**: AsyncStorage та WatermelonDB для локального зберігання
- **Віддалене сховище**: Supabase для хмарного зберігання
- **Синхронізація**: Механізми для синхронізації локальних та віддалених даних

## Потік даних

```
┌────────────────────────┐      ┌────────────────────┐
│                        │      │                    │
│   UI (React Native)    │◄────►│  Бізнес-логіка     │
│                        │      │                    │
└────────────────────────┘      └─────────┬──────────┘
                                          │
                                          ▼
                                ┌─────────────────────┐
                                │                     │
                                │ Локальне сховище    │
                                │ (WatermelonDB)      │
                                │                     │
                                └──────────┬──────────┘
                                           │
                                           ▼
                                ┌─────────────────────┐
                                │                     │
                                │ Віддалене сховище   │
                                │ (Supabase)          │
                                │                     │
                                └─────────────────────┘
```

## Компонентна архітектура

### Атомарний дизайн

Проєкт використовує принципи атомарного дизайну для організації компонентів:

1. **Атоми** (`components/ui/`): Базові компоненти, такі як кнопки, поля вводу, тексти
2. **Молекули**: Комбінації атомів, наприклад, форми входу, картки проєктів
3. **Організми**: Складніші компоненти, що об'єднують молекули, наприклад, панель навігації
4. **Шаблони**: Макети сторінок, що визначають структуру екранів
5. **Сторінки** (`app/`): Конкретні екрани додатку

### Основні компоненти

```
components/
├── ui/               # Атомарні компоненти
│   ├── button.tsx    # Кнопка
│   ├── input.tsx     # Поле вводу
│   ├── text.tsx      # Текст
│   └── ...
├── forms/            # Форми
│   ├── auth-form.tsx # Форма авторизації
│   └── ...
├── layout/           # Компоненти макету
│   ├── header.tsx    # Заголовок
│   └── ...
└── ...
```

## Управління станом

Додаток використовує комбінацію React контекстів та локального стану для управління даними:

1. **React Context API**: Для глобального стану (автентифікація, теми тощо)
2. **Local Component State**: Для локального стану компонентів
3. **WatermelonDB**: Для локального зберігання та синхронізації даних

## Маршрутизація

Маршрутизація реалізована за допомогою Expo Router, що базується на файловій системі:

```
app/
├── (protected)/       # Захищені маршрути (потребують авторизації)
│   ├── (tabs)/        # Маршрути з нижньою навігацією
│   │   ├── index.tsx  # Головний екран
│   │   └── ...
│   └── ...
├── sign-in.tsx        # Екран входу
├── sign-up.tsx        # Екран реєстрації
└── ...
```

## Синхронізація даних

Механізм синхронізації даних включає:

1. **Локальне зберігання**: Всі дані спочатку зберігаються локально
2. **Відкладена синхронізація**: Зміни синхронізуються з сервером, коли є з'єднання
3. **Вирішення конфліктів**: Стратегія "last-write-wins" для вирішення конфліктів

## Безпека

Безпека забезпечується на декількох рівнях:

1. **Автентифікація користувачів**: Supabase Auth
2. **Безпечне зберігання даних**: Шифрування чутливих даних
3. **Row-Level Security**: Політики безпеки на рівні рядків у Supabase
4. **Валідація даних**: Валідація на клієнті за допомогою Zod

## Розширюваність

Архітектура спроєктована для легкого розширення:

1. **Модульна структура**: Розділення коду на незалежні модулі
2. **Абстракції**: Використання абстракцій для легкої заміни компонентів
3. **Інверсія залежностей**: Зменшення зв'язків між компонентами

## Тестування

Стратегія тестування включає:

1. **Unit тести**: Тестування окремих функцій та компонентів
2. **Integration тести**: Тестування взаємодії між компонентами
3. **End-to-End тести**: Тестування повного потоку користувача

## Продуктивність

Оптимізація продуктивності досягається через:

1. **Мемоізація**: Використання React.memo та useMemo
2. **Віртуалізація списків**: Використання FlatList для великих списків
3. **Ледаче завантаження**: Завантаження ресурсів за потреби
4. **Кешування запитів**: Зменшення кількості мережевих запитів

## Майбутні розширення

Архітектура підтримує майбутні розширення:

1. **Нові функції**: Легке додавання нових екранів та функцій
2. **Масштабування**: Підтримка зростаючої бази користувачів
3. **Інтеграції**: Додавання інтеграцій з зовнішніми сервісами

## Висновок

Архітектура "Розрахуй і В'яжи" побудована з урахуванням принципів Offline-First, типобезпеки та модульності. Вона забезпечує гнучку основу для розвитку додатку та додавання нових функцій.